
<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<title></title>
</head>
<body>


<script type="text/javascript">
	
    function next(chars) {
        var length = chars.length;
        for (var i = length - 1; i > 0; i--) {
          var isMatch = true;
          for (var j = 0; j <= i; j++) {
            if (chars[j] !== chars[length - i + j]) {
              isMatch = false;
              break;
            }
          }
          if (isMatch) return length - i;
        }
        return length;
    }

    function KMP(sourceStr, searchStr) {
        var sourceLength = sourceStr.length;
        var searchLength = searchStr.length;
        var result;
        var i = 0;
        var j = 0;

       for (; i < sourceStr.length; i++) { //最外层循环，主串

            //子循环
            for (var j = 0; j < searchLength; j++) {
                //如果与主串匹配
                if (searchStr.charAt(j) == sourceStr.charAt(i)) {
                    //如果是匹配完成
                    if (j == searchLength - 1) {
                      result = i - j;
                      break;
                    } else {
                      //如果匹配到了，就继续循环，i++是用来增加主串的下标位
                      i++;
                    }
                } else {
                  if (j > 1) {
                    i += i - next(searchStr.slice(0,j));
                  } else {
                    //移动一位
                    i = (i - j)
                  }
                  break;
                }
            }

            if (result || result == 0) {
              break;
            }
        }


        if (result || result == 0) {
          return result
        } else {
          return -1;
        }
    }

  var s = "BBC ABCDAB ABCDABCDABDE";
  var t = "ABCDABD";

  console.log( KMP(s,t) );

  console.log(s.indexOf(t));

</script>
</body>
</html>