
<!doctype html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<title></title>
</head>
<body>


<script type="text/javascript">
	

  function kmpGetStrPartMatchValue(str) {
    var prefix = [];
    var suffix = [];
    var partMatch = [];
    for (var i = 0, j = str.length; i < j; i++) {
      var newStr = str.substring(0, i + 1);
      if (newStr.length == 1) {
        partMatch[i] = 0;
      } else {
        for (var k = 0; k < i; k++) {
          //取前缀
          prefix[k] = newStr.slice(0, k + 1);
          suffix[k] = newStr.slice(-k - 1);
          if (prefix[k] == suffix[k]) {
            partMatch[i] = prefix[k].length;
          }
        }
        if (!partMatch[i]) {
          partMatch[i] = 0;
        }
      }
    }
    prefix.length = 0;
    suffix.length = 0;
    return partMatch;
  }



  function KMP1(sourceStr, searchStr) {
      var path  = kmpGetStrPartMatchValue(searchStr)

      var i = 0,
          j = 0;

        while (i < sourceStr.length) {
            // 两字母相等则继续  
            if (sourceStr.charAt(i) == searchStr.charAt(j)) {
              i++;
              j++;
            } else { // 两字母不等则角标后退重新开始匹配  
              var matched = searchStr.slice(0,j)
              console.log(searchStr,matched,j)


              i = i - j + 1; // i 回退到上次匹配首位的下一位  
              j = 0; // j 回退到子串的首位  
            }

            if (j == searchStr.length) {
              return i - j;
            }

        }
  }


    function KMP(sourceStr, targetStr) {
        var partMatchValue = kmpGetStrPartMatchValue(targetStr);
        var result = false;
        for (var i = 0, j = sourceStr.length; i < j; i++) {
          for (var m = 0, n = targetStr.length; m < n; m++) {
            if (targetStr.charAt(m) == sourceStr.charAt(i)) {
              if (m == targetStr.length - 1) {
                result = true;
                break;
              } else {
                i++;
              }
            } else {
              if (m > 0 && partMatchValue[m - 1] > 0) {
                m = partMatchValue[m - 1] - 1;
              } else {
                break;
              }
            }
          }
          if (result) {
            break;
          }
        }
        return result;
    }

  var s = "BBC ABCDAB ABCDABCDABDE";
  var t = "ABCDABD";

  console.log( KMP(s,t) );

  // console.log(s.indexOf(t));

</script>
</body>
</html>